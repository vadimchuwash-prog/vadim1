"""
ü§ñ UTILS MODULE
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞

–§—É–Ω–∫—Ü–∏–∏:
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –∏ –¥–∞—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—á—ë—Ç—ã –∫–æ–º–∏—Å—Å–∏–π
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω
"""

import math
from datetime import datetime, timezone
from typing import Union, Optional


# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def format_usd(amount: float, decimals: int = 2) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É –≤ USD
    
    Args:
        amount: –°—É–º–º–∞
        decimals: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    return f"${amount:,.{decimals}f}"


def format_percent(value: float, decimals: int = 2) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç
    
    Args:
        value: –ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 –¥–ª—è 5%)
        decimals: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    return f"{value:.{decimals}f}%"


def format_price(price: float, symbol: str = "BTCUSDT") -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–Ω–∞–∫–æ–≤
    
    Args:
        price: –¶–µ–Ω–∞
        symbol: –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞
    """
    # –î–ª—è BTC –∏ ETH - 2 –∑–Ω–∞–∫–∞, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –±–æ–ª—å—à–µ
    if "BTC" in symbol or "ETH" in symbol:
        return f"{price:.2f}"
    else:
        return f"{price:.4f}"


def format_size(size: float, decimals: int = 4) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    
    Args:
        size: –†–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö
        decimals: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    return f"{size:.{decimals}f}"


def format_timestamp(dt: Optional[datetime] = None) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
    
    Args:
        dt: Datetime –æ–±—ä–µ–∫—Ç (–µ—Å–ª–∏ None - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è)
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    if dt is None:
        dt = datetime.now(timezone.utc)
    return dt.strftime("%Y-%m-%d %H:%M:%S")


# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –û–ö–†–£–ì–õ–ï–ù–ò–ï –ò –†–ê–°–ß–Å–¢–´
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def round_price(price: float, tick_size: float = 0.01) -> float:
    """
    –û–∫—Ä—É–≥–ª–∏—Ç—å —Ü–µ–Ω—É –¥–æ tick size
    
    Args:
        price: –¶–µ–Ω–∞
        tick_size: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ —Ü–µ–Ω—ã
    
    Returns:
        –û–∫—Ä—É–≥–ª—ë–Ω–Ω–∞—è —Ü–µ–Ω–∞
    """
    return round(price / tick_size) * tick_size


def round_size(size: float, step_size: float = 0.001) -> float:
    """
    –û–∫—Ä—É–≥–ª–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –¥–æ step size
    
    Args:
        size: –†–∞–∑–º–µ—Ä
        step_size: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ —Ä–∞–∑–º–µ—Ä–∞
    
    Returns:
        –û–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    """
    return math.floor(size / step_size) * step_size


def calculate_fee(amount: float, fee_rate: float = 0.0004) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é
    
    Args:
        amount: –°—É–º–º–∞ —Å–¥–µ–ª–∫–∏
        fee_rate: –°—Ç–∞–≤–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏ (0.04% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    
    Returns:
        –°—É–º–º–∞ –∫–æ–º–∏—Å—Å–∏–∏
    """
    return amount * fee_rate


def calculate_pnl(entry_price: float, exit_price: float, 
                  size: float, side: str) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å PnL –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏
    
    Args:
        entry_price: –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
        exit_price: –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞
        size: –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ("Buy" –∏–ª–∏ "Sell")
    
    Returns:
        PnL –≤ USD
    """
    side_mult = 1 if side.lower() in ['buy', 'long'] else -1
    return (exit_price - entry_price) * size * side_mult


def calculate_pnl_percent(entry_price: float, exit_price: float, 
                          side: str) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    
    Args:
        entry_price: –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
        exit_price: –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞
        side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ("Buy" –∏–ª–∏ "Sell")
    
    Returns:
        PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    """
    if entry_price == 0:
        return 0.0
    
    if side.lower() in ['buy', 'long']:
        return ((exit_price - entry_price) / entry_price) * 100
    else:
        return ((entry_price - exit_price) / entry_price) * 100


# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –í–ê–õ–ò–î–ê–¶–ò–Ø
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def is_valid_price(price: float) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã
    
    Args:
        price: –¶–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    
    Returns:
        True –µ—Å–ª–∏ —Ü–µ–Ω–∞ –≤–∞–ª–∏–¥–Ω–∞
    """
    return price > 0 and math.isfinite(price)


def is_valid_size(size: float, min_size: float = 0.001) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
    
    Args:
        size: –†–∞–∑–º–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        min_size: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–∞–∑–º–µ—Ä
    
    Returns:
        True –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –≤–∞–ª–∏–¥–µ–Ω
    """
    return size >= min_size and math.isfinite(size)


def is_valid_balance(balance: float, required: float) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∞
    
    Args:
        balance: –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
        required: –¢—Ä–µ–±—É–µ–º–∞—è —Å—É–º–º–∞
    
    Returns:
        True –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
    """
    return balance >= required


# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –†–ê–°–°–¢–û–Ø–ù–ò–Ø –ò –ü–†–û–¶–ï–ù–¢–´
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def percent_diff(price1: float, price2: float) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏
    
    Args:
        price1: –ü–µ—Ä–≤–∞—è —Ü–µ–Ω–∞
        price2: –í—Ç–æ—Ä–∞—è —Ü–µ–Ω–∞
    
    Returns:
        –†–∞–∑–Ω–∏—Ü–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    """
    if price1 == 0:
        return 0.0
    return abs((price2 - price1) / price1) * 100


def calculate_distance_percent(current_price: float, target_price: float,
                                side: str) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    
    Args:
        current_price: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
        target_price: –¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞
        side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ("Buy" –∏–ª–∏ "Sell")
    
    Returns:
        –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
    """
    if current_price == 0:
        return 0.0
    
    if side.lower() in ['buy', 'long']:
        # –î–ª—è LONG: TP –≤—ã—à–µ, DCA –Ω–∏–∂–µ
        return ((target_price - current_price) / current_price) * 100
    else:
        # –î–ª—è SHORT: TP –Ω–∏–∂–µ, DCA –≤—ã—à–µ
        return ((current_price - target_price) / current_price) * 100


def apply_percent_offset(price: float, percent: float, side: str,
                         direction: str = 'up') -> float:
    """
    –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –∫ —Ü–µ–Ω–µ
    
    Args:
        price: –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
        percent: –ü—Ä–æ—Ü–µ–Ω—Ç —Å–º–µ—â–µ–Ω–∏—è
        side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ("Buy" –∏–ª–∏ "Sell")
        direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏—è ("up" –∏–ª–∏ "down")
    
    Returns:
        –ù–æ–≤–∞—è —Ü–µ–Ω–∞
    """
    multiplier = 1 + (percent / 100)
    
    if direction == 'up':
        return price * multiplier
    else:
        return price / multiplier


# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –í–†–ï–ú–Ø
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def get_seconds_since(dt: Optional[datetime]) -> float:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    
    Args:
        dt: Datetime –æ–±—ä–µ–∫—Ç
    
    Returns:
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ (float)
    """
    if dt is None:
        return float('inf')
    
    now = datetime.now(timezone.utc)
    if dt.tzinfo is None:
        dt = dt.replace(tzinfo=timezone.utc)
    
    return (now - dt).total_seconds()


def get_minutes_since(dt: Optional[datetime]) -> float:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω—É—Ç —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    
    Args:
        dt: Datetime –æ–±—ä–µ–∫—Ç
    
    Returns:
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω—É—Ç (float)
    """
    return get_seconds_since(dt) / 60


def get_hours_since(dt: Optional[datetime]) -> float:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    
    Args:
        dt: Datetime –æ–±—ä–µ–∫—Ç
    
    Returns:
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (float)
    """
    return get_seconds_since(dt) / 3600
